# Python ile CSV ve JSON iÅŸlemleri <!-- omit in toc -->

## Ä°Ã§erikler <!-- omit in toc -->

- [Ã–nemli Bilgiler](#%c3%96nemli-bilgiler)
- [DataFrame MetodlarÄ±](#dataframe-metodlar%c4%b1)
- [CSV Ä°ÅŸlemlerine GiriÅŸ](#csv-%c4%b0%c5%9flemlerine-giri%c5%9f)
- [Pandas ile CSV OluÅŸturma](#pandas-ile-csv-olu%c5%9fturma)
- [JSON Nedir](#json-nedir)
- [JSON YapÄ±sÄ±](#json-yap%c4%b1s%c4%b1)
- [JSON Okuma](#json-okuma)
- [GZIP](#gzip)

## Ã–nemli Bilgiler

- CSV, JSON iÅŸlemleri iÃ§in `pandas` _package_'Ä± kullanÄ±lÄ±r
- `DataFrame`, `pandas` paketinin bir objesidir

## DataFrame MetodlarÄ±

| Metod                            | AÃ§Ä±klama                                        |
| -------------------------------- | ----------------------------------------------- |
| `df.head()`                      | Verilerin baÅŸlangÄ±Ã§ kÄ±smÄ±ndan birazÄ±nÄ± gÃ¶sterme |
| `df.read_csv(<dosya yolu>)`      | CSV dosyasÄ±nÄ± okuma                             |
| `df.to_csv(<dosya yolu>)`        | CSV dosyasÄ± oluÅŸturma                           |
| `df.read_json(<dosya yolu>)`     | JSON dosyasÄ±nÄ± okuma                            |
| `df.to_json(<dosya yolu | url>)` | JSON dosyasÄ± oluÅŸturma                          |

## CSV Ä°ÅŸlemlerine GiriÅŸ

- Csv en sade tablo verisi formatÄ±dÄ±r
- `,` karakteri ile veriler ayrÄ±lÄ±r
- `pandas` moduÃ¼lÃ¼ ile ele alÄ±nÄ±r

<details>
<summary>Temel csv dosyasÄ± okuma</summary>

```python
list_table = []
with open('./data/csv_sample.txt', 'r') as f:
    for line in f.readlines():
        list_table.append(line.strip().split(','))

list_table
```

```bash
[['index', 'name', 'age'],
 ['0', 'Dylan', '28'],
 ['1', 'Terrence', '54'],
 ['2', 'Mya', '31']]
```

</details>

<details>
<summary>pandas ile csv okuma</summary>

```python
import pandas as pd

df = pd.read_csv('./data/csv_sample.txt', index_col=0)
df
```

![](../../res/csv_out0.png)

</details>

## Pandas ile CSV OluÅŸturma

- CSV dosyalarÄ±nda veriler `,` karaterine gÃ¶re sÃ¼tunlara yerleÅŸir
- TanÄ±mlanmayan alanlara `NaN` yazÄ±lÄ±r

<details>
<summary>Basit CSV dosyasÄ± oluÅŸturma</summary>

```python
pd.DataFrame({'a': [0, 3, 10], 'b': [True, True, False]})\
    .to_csv('./data/pd_write.csv')

pd.read_csv('./data/pd_write.csv', index_col=0)
```

![](../../res/csv_out1.png)

</details>

## JSON Nedir

- JavaScript Object Notation olarak aÃ§Ä±lÄ±r
- JavaScript'te bilgileri aktarmak iÃ§in kullanÄ±lÄ±r
- Internet Ã¼zeriindenki Ã§oÄŸu veri JSON tipindedir
  - Web Ã¼zeride Javascript Ã§ok fazla kullanÄ±lmaktadÄ±r
  - Google, Twitter vs.

## JSON YapÄ±sÄ±

- `dict` ve `list`'in harmanlanmÄ±ÅŸ hali denebilir

<details>
<summary>JSON Ã¶rneÄŸi</summary>

```python
book1 = {'title': 'The Prophet',
         'author': 'Khalil Gibran',
         'genre': 'poetry',
         'tags': ['religion', 'spirituality', 'philosophy', 'Lebanon', 'Arabic', 'Middle East'],
         'book_id': '811.19',
         'copies': [{'edition_year': 1996,
                     'checkouts': 486,
                     'borrowed': False},
                    {'edition_year': 1996,
                     'checkouts': 443,
                     'borrowed': False}]
         }

book2 = {'title': 'The Little Prince',
         'author': 'Antoine de Saint-Exupery',
         'genre': 'children',
         'tags': ['fantasy', 'France', 'philosophy', 'illustrated', 'fable'],
         'id': '843.912',
         'copies': [{'edition_year': 1983,
                     'checkouts': 634,
                     'borrowed': True,
                     'due_date': '2017/02/02'},
                    {'edition_year': 2015,
                     'checkouts': 41,
                     'borrowed': False}]
         }

library = [book1, book2]
library
```

```bash
[{'title': 'The Prophet',
  'author': 'Khalil Gibran',
  'genre': 'poetry',
  'tags': ['religion',
   'spirituality',
   'philosophy',
   'Lebanon',
   'Arabic',
   'Middle East'],
  'book_id': '811.19',
  'copies': [{'edition_year': 1996, 'checkouts': 486, 'borrowed': False},
   {'edition_year': 1996, 'checkouts': 443, 'borrowed': False}]},
 {'title': 'The Little Prince',
  'author': 'Antoine de Saint-Exupery',
  'genre': 'children',
  'tags': ['fantasy', 'France', 'philosophy', 'illustrated', 'fable'],
  'id': '843.912',
  'copies': [{'edition_year': 1983,
    'checkouts': 634,
    'borrowed': True,
    'due_date': '2017/02/02'},
   {'edition_year': 2015, 'checkouts': 41, 'borrowed': False}]}]
```

</details>

## JSON Okuma

- JSON dosyalarÄ± `f.read()` ÅŸeklinde deÄŸil, `json.load(f)` ÅŸekinde okunur

> `f`, dosya objesi

<details>
<summary>JSON'Ä± f.read ile okuma</summary>

```python
# note that if we loaded it in without JSON
# the file would be interpreted as plain text

with open('./data/library.json', 'r') as f:
    library_string = f.read()

# this isn't what we want
library_string
```

```bash
'[\n  {\n    "title": "The Prophet",\n    "author": "Khalil Gibran",\n    "genre": "poetry",\n    "tags": [\n      "religion",\n      "spirituality",\n      "philosophy",\n      "Lebanon",\n      "Arabic",\n      "Middle East"\n    ],\n    "book_id": "811.19",\n    "copies": [\n      {\n        "edition_year": 1996,\n        "checkouts": 486,\n        "borrowed": false\n      },\n      {\n        "edition_year": 1996,\n        "checkouts": 443,\n        "borrowed": false\n      }\n    ]\n  },\n  {\n    "title": "The Little Prince",\n    "author": "Antoine de Saint-Exupery",\n    "genre": "children",\n    "tags": [\n      "fantasy",\n      "France",\n      "philosophy",\n      "illustrated",\n      "fable"\n    ],\n    "id": "843.912",\n    "copies": [\n      {\n        "edition_year": 1983,\n        "checkouts": 634,\n        "borrowed": true,\n        "due_date": "2017/02/02"\n      },\n      {\n        "edition_year": 2015,\n        "checkouts": 41,\n        "borrowed": false\n      }\n    ]\n  }\n]'
```

</details>

<details>
<summary>JSON'Ä± json.load(f) ile okuma</summary>

```python
with open('./data/library.json', 'r') as f:
    reloaded_library = json.load(f)

reloaded_library
```

```bash
[{'title': 'The Prophet',
  'author': 'Khalil Gibran',
  'genre': 'poetry',
  'tags': ['religion',
   'spirituality',
   'philosophy',
   'Lebanon',
   'Arabic',
   'Middle East'],
  'book_id': '811.19',
  'copies': [{'edition_year': 1996, 'checkouts': 486, 'borrowed': False},
   {'edition_year': 1996, 'checkouts': 443, 'borrowed': False}]},
 {'title': 'The Little Prince',
  'author': 'Antoine de Saint-Exupery',
  'genre': 'children',
  'tags': ['fantasy', 'France', 'philosophy', 'illustrated', 'fable'],
  'id': '843.912',
  'copies': [{'edition_year': 1983,
    'checkouts': 634,
    'borrowed': True,
    'due_date': '2017/02/02'},
   {'edition_year': 2015, 'checkouts': 41, 'borrowed': False}]}]
```

</details>

<details>
<summary>URL ile JSON okuma</summary>

```python
pd.read_json('https://api.github.com/repos/pydata/pandas/issues?per_page=5')
```

![](../../res/csv_out3.png)

</details>

## GZIP

- Ã‡ok sÄ±k kullanÄ±lan sÄ±kÄ±ÅŸtÄ±rma tipidir
- [deflate algorithm](http://www.infinitepartitions.com/art001.html) yÃ¶ntemini kullanÄ±r
  - DÃ¼ÅŸÃ¼k verili dosyalarda verimli Ã§alÄ±ÅŸmaz ðŸ˜¢
  - `10, 10, 10, 2, 3, 3, 3, 3, 3, 50, 50, 1, 1, 50, 10, 10, 10, 10` (18 sayÄ±) yerine
  - `(3, 10), (1, 2), (5, 3), (2, 50), (2, 1), (1, 50), (4, 10)` (14 sayÄ±) yazÄ±lÄ±r
  - 3 tane 10, 1 tane 2, 5 tane 3 ...
- Sade metin yerine kodlanmÄ±ÅŸ metin barÄ±ndÄ±rÄ±r
- Dosya iÅŸlemlerinde `w` deÄŸil `wb` kullanÄ±lÄ±r

> `w` plaint text, `wb` binary text ÅŸeklinde yazar

<details>
<summary>DetaylÄ± aÃ§Ä±klama</summary>

Another way we save storage and network resources is by using **compression**. Many times data sets will contain patterns that can be used to reduce the amount of space needed to store the information.

A simple example is the following list of numbers: 10, 10, 10, 2, 3, 3, 3, 3, 3, 50, 50, 1, 1, 50, 10, 10, 10, 10

Rather than writing out the full list of numbers (18 integers), we can represent the same information with only 14 numbers: (3, 10), (1, 2), (5, 3), (2, 50), (2, 1), (1, 50), (4, 10)

Here the first number in each pair is the number of repetitions, and the second number in the pair is the actual value. We've successfully reduced the amount of numbers we need to represent the same data. Most forms of compression use a similar idea, although actual implementations are usually more complex.

In the world of data science, the most common compression is Gzip (which uses the ). Gzip files end with the extension `.gz`.

</details>

<details>
<summary>GZIP ile dosya iÅŸlemleri</summary>

```python
with gzip.open('./data/short_text.txt.gz', 'wb') as f:
    f.write(short_text.encode('utf-8'))
```

</details>
